# ═══════════════════════════════════════════════════════════════════════════════
# FLEXT UNIVERSAL STANDARDS CONFIGURATION
# This file defines centralized standards for ALL FLEXT projects
# Version: 2.0.0 - Ultra-Modern, Git-based, Minimal Exceptions
# ═══════════════════════════════════════════════════════════════════════════════

[flext.meta]
version = "2.0.0"
description = "FLEXT Universal Standards for Modern Python Development"
updated = "2025-01-08"
python_version = "3.13"
architecture = "Clean Architecture + DDD + SOLID + KISS + DRY"

# ═══════════════════════════════════════════════════════════════════════════════
# CORE DEPENDENCIES (Cutting-edge Git versions for maximum innovation)
# ═══════════════════════════════════════════════════════════════════════════════

[flext.dependencies]
# Core Framework Dependencies (Latest stable for production reliability)
singer_sdk = ">=0.47.4,<1.0.0"
httpx = ">=0.28.0,<1.0.0"
pydantic = ">=2.11.0,<3.0.0"
python_dateutil = ">=2.9.0,<3.0.0"
python_dotenv = ">=1.0.0,<2.0.0"
typing_extensions = ">=4.12.0,<5.0.0"

# Development Dependencies (Git versions for latest features)
[flext.dev_dependencies]
# Testing (Bleeding-edge for latest pytest features)
pytest = "git+https://github.com/pytest-dev/pytest.git@main"
pytest_cov = ">=6.2.0"
pytest_asyncio = ">=0.26.0"
pytest_mock = ">=3.14.0"
pytest_timeout = ">=2.4.0"
pytest_xdist = ">=3.7.0"
pytest_benchmark = ">=5.1.0"
hypothesis = ">=6.125.0"

# Code Quality (Latest for maximum standards)
ruff = "git+https://github.com/astral-sh/ruff.git@main"
mypy = "git+https://github.com/python/mypy.git@master"
black = "git+https://github.com/psf/black.git@main"

# Development Tools (Mix of stable and cutting-edge)
pre_commit = ">=4.0.0"
commitizen = ">=4.1.1"
ipython = ">=8.37.0"
rich = "git+https://github.com/Textualize/rich.git@master"
typer = "git+https://github.com/fastapi/typer.git@main"

# Security & Documentation (Stable for security compliance)
bandit = ">=1.8.0"
mkdocs_material = ">=9.5.0"
mkdocstrings = ">=0.29.0"

# ═══════════════════════════════════════════════════════════════════════════════
# FLEXT STANDARD TOOLING CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

[flext.ruff]
line_length = 88
target_version = "py313"
fix = true
show_fixes = true
output_format = "github"
respect_gitignore = true

[flext.ruff.lint]
select = ["ALL"]  # Maximum quality enforcement
ignore = [
    "COM812", "ISC001",  # Formatter conflicts
    "D203", "D213",      # Docstring style (Google enforced)
    "TD003", "FIX002", "ERA001",  # Development flexibility
    "S101",              # Pytest assert requirement
]

[flext.ruff.lint.isort]
force_sort_within_sections = true
combine_as_imports = true
required_imports = ["from __future__ import annotations"]

[flext.ruff.lint.pylint]
max_args = 7
max_branches = 12
max_returns = 6
max_statements = 50
max_locals = 15

[flext.ruff.format]
quote_style = "double"
indent_style = "space"
line_ending = "lf"
docstring_code_format = true
docstring_code_line_length = 72

[flext.mypy]
python_version = "3.13"
strict = true
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
disallow_incomplete_defs = true
check_untyped_defs = true
no_implicit_optional = true
warn_redundant_casts = true
warn_unused_ignores = true
warn_no_return = true
warn_unreachable = true
strict_equality = true
show_error_codes = true
show_error_context = true
show_column_numbers = true
pretty = true

[flext.pytest]
minversion = "9.0"
addopts = [
    "--strict-markers",
    "--strict-config",
    "--verbose",
    "--cov-report=term-missing:skip-covered",
    "--cov-report=html:htmlcov",
    "--cov-report=xml:coverage.xml",
    "--cov-fail-under=85",
    "--maxfail=3",
    "--tb=short",
    "--asyncio-mode=auto",
]
testpaths = ["tests"]
python_files = ["test_*.py", "*_test.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]

[flext.bandit]
exclude_dirs = ["tests", "scripts"]
skips = ["B101"]  # pytest assert requirement

[flext.commitizen]
name = "cz_conventional_commits"
tag_format = "v$version"
update_changelog_on_bump = true
major_version_zero = false

# ═══════════════════════════════════════════════════════════════════════════════
# FLEXT PROJECT STRUCTURE STANDARDS
# ═══════════════════════════════════════════════════════════════════════════════

[flext.structure]
# Required directories for all FLEXT projects
required_dirs = [
    "src/",
    "tests/",
    "docs/",
    ".github/workflows/",
    ".vscode/",
    ".cursor/",
]

# Required files for all FLEXT projects
required_files = [
    "pyproject.toml",
    "README.md",
    "CHANGELOG.md",
    ".env.example",
    ".gitignore",
    ".pre-commit-config.yaml",
    "Makefile",
    ".flext-standards.toml",
]

# Forbidden patterns (to maintain consistency)
forbidden_patterns = [
    "requirements*.txt",  # Use pyproject.toml only
    "setup.py",           # Use pyproject.toml only
    "setup.cfg",          # Use pyproject.toml only
    "tox.ini",            # Use pyproject.toml only
    ".flake8",            # Use ruff in pyproject.toml
    "pytest.ini",         # Use pyproject.toml only
    "mypy.ini",           # Use pyproject.toml only
]

# ═══════════════════════════════════════════════════════════════════════════════
# FLEXT CI/CD STANDARDS
# ═══════════════════════════════════════════════════════════════════════════════

[flext.cicd]
python_version = "3.13"
poetry_version = "2.1.2"
node_version = "20"

# Required GitHub Actions
required_workflows = [
    "ci.yml",           # Main CI/CD pipeline
    "pr-checks.yml",    # Pull request validation
    "release.yml",      # Automated releases
    "security.yml",     # Security scanning
]

# Required CI stages
required_stages = [
    "pre-flight",       # Fast validation
    "quality",          # Code quality checks
    "test",             # Comprehensive testing
    "security",         # Security analysis
    "build",            # Package building
    "docs",             # Documentation generation
]

# Performance targets
performance_targets = [
    "ci_duration_max = '15 minutes'",
    "test_coverage_min = 85",
    "build_time_max = '2 minutes'",
    "startup_time_max = '5 seconds'",
]

# ═══════════════════════════════════════════════════════════════════════════════
# FLEXT MAKEFILE STANDARDS
# ═══════════════════════════════════════════════════════════════════════════════

[flext.makefile]
# Required targets for all FLEXT projects
required_targets = [
    "help", "status", "health-check",
    "install", "setup", "update", "clean-env",
    "format", "lint", "lint-check", "type-check", "security", "quality",
    "test", "test-cov", "test-all",
    "build", "clean", "publish",
    "validate", "ci", "pre-commit",
    "docs", "run", "shell",
]

# Color scheme (FLEXT branding)
colors = [
    "CYAN = \\033[0;36m",
    "BLUE = \\033[0;34m", 
    "GREEN = \\033[0;32m",
    "YELLOW = \\033[0;33m",
    "RED = \\033[0;31m",
    "NC = \\033[0m",
]

# ═══════════════════════════════════════════════════════════════════════════════
# FLEXT VSCODE/CURSOR STANDARDS
# ═══════════════════════════════════════════════════════════════════════════════

[flext.vscode]
# Required settings for consistency
python_interpreter = "${workspaceFolder}/.venv/bin/python"
default_formatter = "charliermarsh.ruff"
line_length = 88
format_on_save = true

# Required extensions
required_extensions = [
    "ms-python.python",
    "charliermarsh.ruff",
    "ms-python.mypy-type-checker",
    "tamasfe.even-better-toml",
    "redhat.vscode-yaml",
]

# FLEXT workspace identification colors
workspace_colors = [
    "statusBar.background = '#007ACC'",
    "titleBar.activeBackground = '#007ACC'",
    "activityBar.activeBackground = '#007ACC33'",
]

[flext.cursor]
# AI-enhanced settings for Cursor
ai_model = "claude-3.5-sonnet"
ai_enabled = true
copilot_enabled = true
context_size_limit = 100000

# FLEXT-specific AI prompt
system_prompt = "You are working on a FLEXT enterprise project. Follow FLEXT standards: PEP 621, modern Python 3.13, strict typing, comprehensive testing, and enterprise-grade code quality."

# ═══════════════════════════════════════════════════════════════════════════════
# FLEXT DOCUMENTATION STANDARDS
# ═══════════════════════════════════════════════════════════════════════════════

[flext.docs]
# Required documentation files
required_docs = [
    "README.md",
    "CHANGELOG.md", 
    "CONTRIBUTING.md",
    "LICENSE",
    "docs/architecture.md",
    "docs/api.md",
    "docs/deployment.md",
]

# Documentation standards
format = "MkDocs with Material theme"
docstring_style = "Google"
api_docs = "Auto-generated from docstrings"
changelog_format = "Conventional Commits"

# ═══════════════════════════════════════════════════════════════════════════════
# FLEXT SECURITY STANDARDS
# ═══════════════════════════════════════════════════════════════════════════════

[flext.security]
# Required security measures
required_scans = [
    "bandit",           # Python security linter
    "secrets_detection", # Detect secrets in code
    "dependency_scan",   # Vulnerable dependency detection
    "container_scan",    # Docker image security (if applicable)
]

# Security policy
secrets_policy = "Zero tolerance - no secrets in code"
dependency_policy = "Auto-update with security patches"
code_policy = "Secure by default, defense in depth"

# ═══════════════════════════════════════════════════════════════════════════════
# FLEXT VERSIONING & RELEASE STANDARDS  
# ═══════════════════════════════════════════════════════════════════════════════

[flext.versioning]
scheme = "Semantic Versioning 2.0.0"
format = "v{major}.{minor}.{patch}"
pre_release_formats = ["alpha", "beta", "rc"]
commit_format = "Conventional Commits"

[flext.release]
# Automated release triggers
triggers = [
    "tag_push = true",
    "manual_dispatch = true", 
    "scheduled_monthly = true",
]

# Release checklist
checklist = [
    "All tests pass",
    "Code coverage >= 85%",
    "Security scan clean",
    "Documentation updated",
    "Changelog generated",
    "Performance benchmarks pass",
]
